# 길튼 시스템 (Gilteun System)

**교회 찬양팀을 위한 실시간 협업 예배 지원 플랫폼**

길튼 시스템은 찬양팀이 연습과 예배 중에 악보를 보고, 실시간으로 주석을 공유하며, 팀 간 소통할 수 있는 종합적인 디지털 플랫폼입니다.

## 📋 주요 기능

### 🎵 실시간 악보 협업

- **Figma 스타일 실시간 주석**: 여러 명이 동시에 악보에 주석을 달고 실시간으로 공유
- **개인별 레이어 관리**: 각 팀원의 주석을 개별적으로 표시하거나 숨김 처리
- **벡터 기반 그리기**: 확대/축소해도 선명한 주석 품질 유지
- **Apple Pencil 지원**: 압력 감지 및 손바닥 거치 방지 기능

### 📱 iPad 최적화 PWA

- **세로모드 우선 설계**: iPad 사용에 최적화된 UI/UX
- **핀치줌 & 더블탭**: 악보 확대/축소 및 fit-to-screen 기능
- **오프라인 지원**: WiFi 연결이 끊어져도 현재 예배 데이터 접근 가능
- **홈화면 설치**: PWA를 통한 네이티브 앱과 같은 사용 경험

### 🔄 실시간 팀 커뮤니케이션

- **빠른 명령 시스템**: "더 힘있게", "템포 업" 등 미리 정의된 명령
- **사용자 정의 명령**: 이모지와 텍스트로 개인화된 명령 생성
- **명령 히스토리**: 최근 전송된 명령들 확인 가능
- **실시간 브로드캐스트**: 모든 팀원에게 즉시 전달

### 🗂️ 예배 및 악보 관리

- **예배 일정 관리**: 달력 기반 예배 생성 및 관리
- **찬양 순서 구성**: 드래그 앤 드롭으로 찬양 순서 변경
- **일괄 악보 업로드**: 여러 악보 파일을 한 번에 업로드
- **메타데이터 관리**: 제목, 키(조), 연주 메모 등 상세 정보

## 🏗️ 시스템 아키텍처

### 서버-클라이언트 구조

```
┌─────────────────┐    WiFi    ┌─────────────────┐
│   Electron 서버  │ ◄────────► │   iPad PWA      │
│                 │            │   클라이언트     │
│ • SQLite DB     │            │                 │
│ • WebSocket     │            │ • 실시간 동기화  │
│ • 파일 저장소    │            │ • 오프라인 캐시  │
│ • 백업/복원     │            │ • 터치 최적화    │
└─────────────────┘            └─────────────────┘
```

### 사용 시나리오

#### 연습 모드

1. **예배 준비**: 관리자가 예배를 생성하고 찬양 목록을 구성
2. **악보 업로드**: 각 찬양별 악보 이미지 파일 업로드
3. **팀 연결**: 팀원들이 각자 iPad로 서버에 접속
4. **협업 주석**: 실시간으로 주석을 달며 연습 포인트 공유
5. **명령 전송**: 인도자가 "더 힘있게", "템포 조절" 등의 지시사항 전달

#### 예배 모드

1. **보기 전용**: 연습 때 작성한 주석들을 참고하며 악보 확인
2. **필요시 수정**: 예배 중에도 새로운 주석 추가 가능
3. **실시간 소통**: 급한 지시사항을 명령 시스템으로 전달

## 🛠️ 기술 스택

### Frontend (PWA)

- **React + TypeScript**: 타입 안전성을 갖춘 컴포넌트 기반 UI
- **Vite**: 빠른 개발 서버 및 빌드 도구
- **TanStack Query + Axios**: 효율적인 서버 상태 관리 및 데이터 페칭
- **Zustand**: 경량 전역 상태 관리
- **Tailwind CSS**: 유틸리티 우선 스타일링
- **Formik**: 폼 유효성 검사 및 상태 관리
- **date-fns**: 날짜 처리 유틸리티

### Backend (Electron Server)

- **Electron**: 크로스 플랫폼 데스크톱 애플리케이션
- **Express**: RESTful API 서버
- **WebSocket**: 실시간 양방향 통신
- **SQLite + Drizzle ORM**: 경량 로컬 데이터베이스
- **Multer**: 파일 업로드 처리
- **Archiver/Unzipper**: 백업/복원 기능

### 주요 라이브러리

- **Lucide React**: 일관된 아이콘 시스템
- **react-use-gesture**: 터치 제스처 처리
- **Framer Motion**: 부드러운 애니메이션

## 📱 지원 플랫폼

### 서버

- **Windows 10/11**: Electron 데스크톱 애플리케이션
- **macOS**: Intel 및 Apple Silicon 지원

### 클라이언트

- **iPad**: iOS Safari 브라우저 PWA
- **최적 화면 크기**: 10.2" ~ 12.9" iPad
- **세로 모드**: 기본 사용 방향

## 🚀 설치 및 실행

### 개발 환경 구성

```bash
# 저장소 클론
git clone https://github.com/your-username/gilteun-system.git
cd gilteun-system

# 의존성 설치
npm install

# 개발 서버 실행
npm run dev
```

### 운영 환경 배포

```bash
# 프로덕션 빌드
npm run build

# Electron 앱 패키징
npm run build:electron

# 배포 파일 생성
npm run dist
```

### PWA 클라이언트 접속

1. iPad에서 Safari 브라우저 열기
2. 서버 IP 주소 입력 (예: `http://192.168.1.100:3000`)
3. 공유 버튼 → "홈 화면에 추가" 선택
4. PWA 앱 아이콘으로 접속

## 💾 데이터 구조

### 예배 정보

```typescript
interface Worship {
  id: number;
  title: string; // "3월 15일 금요 기도회"
  date: string; // "2024-03-15"
  time?: string; // "19:30"
  description?: string; // "특별 기도 시간"
  createdAt: string;
}
```

### 찬양 정보

```typescript
interface Song {
  id: number;
  worshipId: number;
  title: string; // "주 은혜임을"
  key?: string; // "G"
  memo?: string; // "2절 후 간주 길게"
  imagePath: string; // "./uploads/song1.jpg"
  order: number; // 1, 2, 3...
}
```

### 주석 데이터

```typescript
interface Annotation {
  id: number;
  songId: number;
  userId: string; // "user-123"
  userName: string; // "김찬양"
  layer: string; // "김찬양의 주석"
  svgPath: string; // SVG 패스 데이터
  color: string; // "#ff0000"
  tool: 'pen' | 'highlighter' | 'eraser';
  createdAt: string;
}
```

## 🔧 주요 설정

### WebSocket 이벤트

- `annotation:start/update/complete`: 실시간 주석 동기화
- `command:send/broadcast`: 명령 전송 및 브로드캐스트
- `user:connect/disconnect`: 사용자 연결 관리
- `sync:request/response`: 데이터 동기화

### 오프라인 캐싱

- **현재 예배**: 모든 악보 이미지 및 주석 데이터
- **앱 셸**: PWA 기본 UI 컴포넌트
- **사용자 설정**: 테마, 레이어 표시 상태 등

### 백업/복원

- **백업 포함 항목**: 예배 데이터, 악보 파일, 주석 정보
- **형식**: ZIP 압축 파일
- **복원**: 원클릭 ZIP 파일 업로드로 완전 복원

## 📊 구현 현황 (2025년 1월 기준)

### ✅ 완료된 기능 (60%)

#### 기본 인프라
- [x] Electron 서버 + Express API 구축
- [x] SQLite + Kysely ORM 마이그레이션 완료
- [x] WebSocket 실시간 통신 구현
- [x] Zustand 상태 관리 설정
- [x] React Router 라우팅 구현

#### 페이지 구현
- [x] **ProfileSelectPage** - 프로필 선택 (기본 구현)
- [x] **WorshipListPage** - 예배 목록 (기본 구현)
- [x] **SongListPage** - 찬양 목록 (기본 구현)
- [x] **ScoreViewerPage** - 악보 뷰어 (부분 구현)

#### 주석 시스템
- [x] Canvas 기반 그리기 엔진 (AnnotationEngine)
- [x] 실시간 주석 동기화 (WebSocket)
- [x] 벡터 기반 SVG 저장
- [x] 레이어 관리 시스템

### ⚠️ 진행 중 (20%)

- [ ] Apple Pencil 압력 감지 최적화
- [ ] 터치 제스처 개선 (핀치 줌, 스와이프)
- [ ] PWA 오프라인 캐싱 구현

### ❌ 미구현 기능 (20%)

#### 페이지 미구현
- [ ] **CommandEditorPage** - 명령 에디터 (placeholder)
- [ ] **AdminPage** - 관리자 패널 (placeholder)
- [ ] **SettingsPage** - 설정 (placeholder)

#### UI/UX 미구현
- [ ] 캘린더 뷰 (날짜별 예배 선택)
- [ ] 새 프로필 생성 다이얼로그
- [ ] 사이드바 네비게이션
- [ ] 다크모드 토글
- [ ] 일괄 악보 업로드 UI
- [ ] 찬양 순서 드래그 앤 드롭

## 🎯 개발 계획

### Phase 1: 핵심 페이지 구현 (✅ 완료 - 2025.08.31)

#### 1-1. CommandEditorPage 구현
- [x] 실시간 명령 전송 UI
- [x] 빠른 명령 템플릿 (이모지 + 텍스트)
- [x] 명령 히스토리 표시
- [x] WebSocket 연동
- [x] **E2E 테스트**: 명령 전송/수신 플로우

#### 1-2. AdminPage 구현
- [x] 멤버 관리 탭 (온라인 상태, 권한)
- [x] 서버 상태 모니터링 탭 (CPU, 메모리, 업타임)
- [x] 데이터 백업/복구 탭
- [x] 실시간 활동 로그
- [x] **E2E 테스트**: 관리자 권한 확인, 백업/복구

#### 1-3. SettingsPage 구현
- [x] 프로필 설정 (이름, 역할, 아이콘)
- [x] 테마 설정 (다크모드)
- [x] 입력 설정 (Apple Pencil 옵션)
- [x] 위험 구역 (프로필 삭제)
- [x] **E2E 테스트**: 설정 저장/로드

### Phase 2: UI/UX 개선 (3-4일)

#### 2-1. 프로필 시스템 개선
- [ ] 새 프로필 생성 다이얼로그
- [ ] 이모지 아이콘 선택기
- [ ] 역할 선택 드롭다운
- [ ] **E2E 테스트**: 프로필 생성/선택/삭제 플로우

#### 2-2. 네비게이션 개선
- [ ] 고정 사이드바 구현
- [ ] 컨텍스트별 메뉴 표시
- [ ] 역할별 메뉴 필터링 (인도자 전용 메뉴)
- [ ] **E2E 테스트**: 네비게이션 플로우

#### 2-3. 캘린더 뷰 추가
- [ ] WorshipListPage에 캘린더 컴포넌트
- [ ] 날짜별 예배 필터링
- [ ] 예배 있는 날 표시 (점 표시)
- [ ] **E2E 테스트**: 날짜 선택 및 필터링

### Phase 3: 고급 기능 (3-4일)

#### 3-1. 파일 업로드 시스템
- [ ] 일괄 악보 업로드 UI
- [ ] 드래그 앤 드롭 존
- [ ] 파일별 메타데이터 편집
- [ ] 업로드 진행 상태 표시
- [ ] **E2E 테스트**: 파일 업로드 플로우

#### 3-2. 드래그 앤 드롭 정렬
- [ ] 찬양 순서 변경 구현
- [ ] react-beautiful-dnd 통합
- [ ] 순서 저장 API 연동
- [ ] **E2E 테스트**: 드래그 앤 드롭 동작

#### 3-3. 다크모드 구현
- [ ] 전역 테마 토글
- [ ] localStorage 영속화
- [ ] 시스템 설정 연동
- [ ] 모든 컴포넌트 다크모드 스타일
- [ ] **E2E 테스트**: 테마 전환

### Phase 4: 기술적 개선 (2-3일)

#### 4-1. 컴포넌트 재사용성
- [ ] 공통 다이얼로그 컴포넌트 생성
- [ ] 폼 유효성 검증 통합 (Formik)
- [ ] 에러 처리 표준화
- [ ] 로딩 상태 통합 관리
- [ ] **단위 테스트**: 재사용 컴포넌트

#### 4-2. 상태 관리 최적화
- [ ] Zustand 스토어 확장 (테마, 설정)
- [ ] 사용자 설정 영속화
- [ ] 오프라인 상태 처리
- [ ] **통합 테스트**: 상태 동기화

#### 4-3. API 통합
- [ ] 명령 전송 API 구현
- [ ] 백업/복구 API 구현
- [ ] 파일 업로드 API 구현
- [ ] API 에러 처리 표준화
- [ ] **API 테스트**: 모든 엔드포인트

### Phase 5: 성능 최적화 및 PWA (2-3일)

#### 5-1. PWA 최적화
- [ ] Service Worker 캐싱 전략
- [ ] 오프라인 모드 구현
- [ ] 설치 프롬프트 UI
- [ ] 아이콘 및 스플래시 스크린
- [ ] **E2E 테스트**: PWA 설치 및 오프라인

#### 5-2. 터치 제스처 최적화
- [ ] 스와이프 페이지 전환
- [ ] 핀치 줌 개선
- [ ] 손바닥 거치 방지
- [ ] 제스처 충돌 해결
- [ ] **E2E 테스트**: iPad 터치 제스처

#### 5-3. 성능 최적화
- [ ] React.memo 적용
- [ ] 이미지 lazy loading
- [ ] 코드 스플리팅
- [ ] 번들 크기 최적화
- [ ] **성능 테스트**: Lighthouse 점수

## 📈 진행 상황 추적

### 주요 마일스톤
| Phase | 예상 기간 | 진행률 | 상태 |
|-------|----------|--------|------|
| Phase 1 | 1주 | 100% | ✅ 완료 |
| Phase 2 | 3-4일 | 10% | 🟡 진행 중 |
| Phase 3 | 3-4일 | 0% | 🔴 시작 전 |
| Phase 4 | 2-3일 | 0% | 🔴 시작 전 |
| Phase 5 | 2-3일 | 0% | 🔴 시작 전 |

### 우선순위 작업 (다음 단계)
1. **⚡ 높음**: 사이드바 네비게이션 구현
2. **⚡ 높음**: 캘린더 뷰 추가
3. **🔶 중간**: 일괄 악보 업로드 UI
4. **🔶 중간**: 찬양 순서 드래그 앤 드롭
5. **🔶 중간**: PWA 오프라인 캐싱

## 🧪 테스트 전략

### E2E 테스트 (Playwright)
- 모든 페이지 네비게이션 플로우
- 프로필 생성/선택/삭제
- 예배 및 찬양 CRUD
- 실시간 주석 동기화
- 명령 전송/수신
- PWA 설치 및 오프라인

### 통합 테스트
- API 엔드포인트 검증
- WebSocket 이벤트 처리
- 데이터베이스 트랜잭션
- 파일 업로드/다운로드

### 단위 테스트
- 재사용 컴포넌트
- 커스텀 훅
- 유틸리티 함수
- Zustand 스토어

## 🤝 기여 가이드

### 개발 규칙

- **Code Style**: Prettier + ESLint 설정 준수
- **Commit Message**: Conventional Commits 형식
- **Branch**: feature/기능명 브랜치에서 작업 후 PR

### 테스트

```bash
# 단위 테스트
npm run test

# E2E 테스트
npm run test:e2e

# 타입 체크
npm run type-check
```

---

**길튼 시스템으로 더욱 은혜로운 찬양 시간을 만들어보세요!** 🎵✨
